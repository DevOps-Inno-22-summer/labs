# Lab 14

## kube-prometheus-stack components

- Prometheus: a tool to monitor (and collect alerts) from your application.
- Prometheus Operator: facilitates the management and automation of Prometheus stack for K8s.
- Prometheus Node-exporter: monitor OS and hardware metrics.
- Kube State Metrics (KSM): collects and expose K8s cluster metrics (without modification).
- Prometheus Adapter: collects metrics from K8s Metrics API (adapted to Prometheus format).
- Grafana: A web dashboard application to present and visualize collected metrics.
- Prometheus Alertmanager: handles incoming alerts from applications. Benefits include alerts routing, grouping, dedeuplicating, and silencing of alerts.

## Result and meaning of `kubectl get`

![kubectl get part 1](../screenshots/lab14/kubectl-get-1.png)
![kubectl get part 2](../screenshots/lab14/kubectl-get-2.png)

### Command meaning

The `kubectl get po,sts,svc,pvc,cm` prints details on the specified objects running in K8s.

In this command, the following objects are printed:

- po: Pod
- sts: StatefulSet
- svc: Service
- pvc: Persistent Volume Claim
- cm: Config Map

By investigating the output after installing the `kube-prometheus-stack`,
one could find many services running beside the intended app.
For example, there is a large number of Config Maps (almost one per Prometheus Stack object).

## Dashboard Screenshots

### 1 and 2. CPU

For some reason, the CPU metrics are not being logged by Prometheus.

If you know why, please let me know and I will try to fix it.

I suspect it could be related to running the CPU monitoring service on Docker, without proper access.

Another issue could possibly be the misalignment of ports.

![Missing CPU Logs](../screenshots/lab14/1-missing-cpu.png)

### 3. Memory used in node

![Memory usage in node](../screenshots/lab14/3-memory-usage.png)

### 4. Pods and containers by Kubelet

![Kubelet pods and containers](../screenshots/lab14/4-kubelet.png)

### 5. Network pods

![Network Max](../screenshots/lab14/5-network-max.png)
![Network Min](../screenshots/lab14/5-network-min.png)

### 6. Alerts

![Alerts](../screenshots/lab14/6-alertsmanager.png)

## Init Container

The file downloaded is a [simple HTML page](https://dataquestio.github.io/web-scraping-pages/simple.html).

![Init container cat file](../screenshots/lab14/init-container-cat.png)
