# Lab 14: K8s


## Explanation of monotoring stack components.

- Prometheus Operator is an additional feature of Kubernetes that make it simple to automate the configuration of Prometheus. 

- Highly available Prometheus gathers metrics and saves them in a database. Helped by it functional sharding, Prometheus stores time series in memory and on local disk making it highly available.

- Highly available Alertmanager group, deduplicate, and route manages alerts sent by application clients and routes them to the appropriate receiver, such as email.

- Prometheus node-exporter provides hardware and operating system related metrics.

- Prometheus Adapter for Kubernetes Metrics APIs is an adapter that implements metrics from the Kuberenetes API,

- kube-state-metrics create metrics directly from Kubernetes API objects such as nodes, pods, and deployments.

- Grafana a tool that make it easy to visualizes metrics collected by other tools (like Prometheus).

## kubectl get output with explanation

```shell
kubectl get po,sts,svc,pvc,cm 
NAME                                                            READY   STATUS    RESTARTS   AGE
pod/alertmanager-kube-prometheus-stack-alertmanager-0           2/2     Running   0          12m
pod/app-python-0                                                0/1     Running   0          27s
pod/app-python-1                                                0/1     Running   0          27s
pod/app-python-2                                                0/1     Running   0          27s
pod/kube-prometheus-stack-grafana-76b54c4c7b-gbw6z              3/3     Running   0          12m
pod/kube-prometheus-stack-kube-state-metrics-7b69985888-th7mm   1/1     Running   0          12m
pod/kube-prometheus-stack-operator-79dd464b88-qcvrz             1/1     Running   0          12m
pod/kube-prometheus-stack-prometheus-node-exporter-7g5cd        1/1     Running   0          12m
pod/prometheus-kube-prometheus-stack-prometheus-0               2/2     Running   0          12m

NAME                                                               READY   AGE
statefulset.apps/alertmanager-kube-prometheus-stack-alertmanager   1/1     12m
statefulset.apps/app-python                                        0/3     27s
statefulset.apps/prometheus-kube-prometheus-stack-prometheus       1/1     12m

NAME                                                     TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                            ClusterIP      None             <none>        9093/TCP,9094/TCP,9094/UDP   12m
service/app-python                                       NodePort       10.99.215.163    <none>        5000:31077/TCP               27s
service/devops-lab-app-deployment                        LoadBalancer   10.108.235.102   <pending>     5000:32345/TCP               14d
service/kube-prometheus-stack-alertmanager               ClusterIP      10.98.56.187     <none>        9093/TCP                     12m
service/kube-prometheus-stack-grafana                    ClusterIP      10.100.205.84    <none>        80/TCP                       12m
service/kube-prometheus-stack-kube-state-metrics         ClusterIP      10.106.101.30    <none>        8080/TCP                     12m
service/kube-prometheus-stack-operator                   ClusterIP      10.100.229.102   <none>        443/TCP                      12m
service/kube-prometheus-stack-prometheus                 ClusterIP      10.111.92.25     <none>        9090/TCP                     12m
service/kube-prometheus-stack-prometheus-node-exporter   ClusterIP      10.101.206.132   <none>        9100/TCP                     12m
service/kubernetes                                       ClusterIP      10.96.0.1        <none>        443/TCP                      14d
service/prometheus-operated                              ClusterIP      None             <none>        9090/TCP                     12m

NAME                                        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/visits-app-python-0   Bound    pvc-37d4a246-2034-4f14-89c1-574230ac94e9   128M       RWO            standard       4h44m
persistentvolumeclaim/visits-app-python-1   Bound    pvc-16c48ee1-b252-444a-96f1-45e634743f7c   128M       RWO            standard       4h44m
persistentvolumeclaim/visits-app-python-2   Bound    pvc-271160d5-6c64-4516-a088-06cf1a3988fe   128M       RWO            standard       4h44m

NAME                                                                DATA   AGE
configmap/app-python-configmap                                      1      27s
configmap/kube-prometheus-stack-alertmanager-overview               1      12m
configmap/kube-prometheus-stack-apiserver                           1      12m
configmap/kube-prometheus-stack-cluster-total                       1      12m
configmap/kube-prometheus-stack-controller-manager                  1      12m
configmap/kube-prometheus-stack-etcd                                1      12m
configmap/kube-prometheus-stack-grafana                             2      12m
configmap/kube-prometheus-stack-grafana-config-dashboards           2      12m
configmap/kube-prometheus-stack-grafana-datasource                  1      12m
configmap/kube-prometheus-stack-grafana-overview                    1      12m
configmap/kube-prometheus-stack-grafana-test                        1      12m
configmap/kube-prometheus-stack-k8s-coredns                         1      12m
configmap/kube-prometheus-stack-k8s-resources-cluster               1      12m
configmap/kube-prometheus-stack-k8s-resources-namespace             1      12m
configmap/kube-prometheus-stack-k8s-resources-node                  1      12m
configmap/kube-prometheus-stack-k8s-resources-pod                   1      12m
configmap/kube-prometheus-stack-k8s-resources-workload              1      12m
configmap/kube-prometheus-stack-k8s-resources-workloads-namespace   1      12m
configmap/kube-prometheus-stack-kubelet                             1      12m
configmap/kube-prometheus-stack-namespace-by-pod                    1      12m
configmap/kube-prometheus-stack-namespace-by-workload               1      12m
configmap/kube-prometheus-stack-node-cluster-rsrc-use               1      12m
configmap/kube-prometheus-stack-node-rsrc-use                       1      12m
configmap/kube-prometheus-stack-nodes                               1      12m
configmap/kube-prometheus-stack-nodes-darwin                        1      12m
configmap/kube-prometheus-stack-persistentvolumesusage              1      12m
configmap/kube-prometheus-stack-pod-total                           1      12m
configmap/kube-prometheus-stack-prometheus                          1      12m
configmap/kube-prometheus-stack-proxy                               1      12m
configmap/kube-prometheus-stack-scheduler                           1      12m
configmap/kube-prometheus-stack-workload-total                      1      12m
configmap/kube-root-ca.crt                                          1      14d
configmap/prometheus-kube-prometheus-stack-prometheus-rulefiles-0   29     12m
```

The command `kubctl get` followed by arguments (po, sts, svc, pvc, cm) give information about the following:
- po: about pods in the cluster.
- sts: about statefulset.
- svc: about services.
- pvc: about persistent volume
- cm: about configmap


## Grafana screenshots

How much CPU the StatefulSet is consuming CPU: 0.20 requests
![Screenshoot](https://raw.githubusercontent.com/behouba/devOpsLab/lab14_submission/k8s/images/lab14.1.png)


 Memory consumed: ~ 300.00Mib
![Screenshoot](https://raw.githubusercontent.com/behouba/devOpsLab/lab14_submission/k8s/images/lab14.2.png)


Pod with the highest CPU usage: kube-apiserver-minikube 0.20 CPU requests
![Screenshoot](https://raw.githubusercontent.com/behouba/devOpsLab/lab14_submission/k8s/images/lab14.3.png)


How much memory is used in my node: Percentage: 76.3%, 1.86GiB
![Screenshoot](https://raw.githubusercontent.com/behouba/devOpsLab/lab14_submission/k8s/images/lab14.4.png)


How many pods and containers are run by kubelet service:
![Screenshoot](https://raw.githubusercontent.com/behouba/devOpsLab/lab14_submission/k8s/images/lab14.5.png)

Alerts
![Screenshoot](https://raw.githubusercontent.com/behouba/devOpsLab/lab14_submission/k8s/images/lab14.6.png)


## init Container downloading HTML file
![Screenshoot](https://raw.githubusercontent.com/behouba/devOpsLab/lab14_submission/k8s/images/lab14.7.png)